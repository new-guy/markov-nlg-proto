//var human_phrase_dataset = ["meet me at market square", "let me know if that will work for you", "we don't want the game to last too long", "we'll have some drinks", "I'm back in Durham tomorrow", "I will come up and visit", "I have a sick blow up bed", "we can sit together", "no girls around", "it will start slowly", "no girls allowed", "I hope people remember this", "this has nothing to do with politics", "It's pretty fantastic", "It does give you powerful tools", "the tutorial doesn't seem that bad", "explain why all of these things are on the screen", "visit when it is time to visit", "this phrase was made by a human", "this phrase was not made by a human", "hopefully people will read this", "please help I'm trapped in the computer", "this one was written by the algorithm", "I am staying at Subodha's tonight", "it is dangerous to wear blue", "it can be scary outside at night", "it is starting to get a bit dark", "the walls around me are white", "I have a chicago bears hat to my right", "hopefully this will be enough", "I am not sure how many phrases will be needed", "We can try using thirty five", "Although I am not sure how much these will line up", "I need an algorithm for rendering the chain visually", "I'm so pumped right now", "Why would you let your dog watch that", "you get called Joe sometimes", "this sentence is a lie", "there are fifty five snails on the wall", "not to be sold separately", "that shirt looks great on you", "give me the laptop", "would you like any chocolate", "what are you gonna do", "that was probably the right choice", "How's it going?", "I tried to think of something clever, I failed.", "I'm just going to the library.", "Hey! How's it going?", "Your hair looks nice.", "Russia will not stand for this", "How do you do?", "Will do.", "How is it going?", "What have you been up to?", "Sounds great.", "What are you doing tomorrow? ", "Did you watch the game? ", "How's it going?", "How about those Chicago Bears?", "Right, see you later.", "What's good?", "You wanna go?", "What's up dog?", "What, seriously?", "How's it going?", "Cold day, isn't it?", "Do you know what time it is?", "It's so great to see you!", "How are you feeling?", "Where should we meet?", "Hey man, how was the show last night?", "I'm so hungry!  Are you?", "What are you up to today?", "How's your mom doing?", "Where do you work?", "How's it going? ", "I'm happy to help. ", "How you doin'?", "You lookin' fine, homeboy!", "Hold your horses!", "Gorillas like bananas", "Hey, what's up?", "Do you need help?", "Good luck!", "how was your day", "Good day, sir.", "Hey how are you?", "Let's go to the Thai supermarket to eat lunch"];
//var human_phrase_dataset = ["I am hungry", "I am full", "I am David"];
var human_phrase_dataset = ["Solid game of football played today #Lions ya'll stepped up your game vs dem #ChiBears..  Sweet as sugar handin the Bears a whoopin!", "OB agrees w me. How is McClellin still on this team?!! #thescore #chibears", "Yes, @ChicagoBears!!! That's how you start the game!!! Let's go!! #CHIvsDET #keepthemomentumgoing #ChiBears", "Bears win today we make playoffs #WinOutTheSeason #ChiBears", "Let's go @ChicagoBears #ChiBears #CHIvDET", "@SeifertESPN @ESPNChiBears that's because they couldn't block anyone.  News flash, the O line is NOT fixed #chibears #bears #nfl", "Could #firetrestman have called #Packers this week for advice on crushing a Lovie defense #chibears #bears", "Remember when every team the #bears played for the past 2 years exploited Major Wright and Isaiah Frey like the liabilities they r #chibears", "Wow #chibears  just awful.", "ME MY SON AND WILLIAM SUTTON GLAD DUDE CAME OUT TO SUPPORT MY KIDS MANN MUCH LUV #BEARS #CHIBEARS… http://instagram.com/p/vjq-c5jnjD/ ", "photo of young Marc trestman #chibears pic.twitter.com/ZR1warKF7F", "It's about game time ladies and gentlemen! #MnVikes vs #ChiBears let's get'em boys!! #SKOLVIKES http://fb.me/1FzDD9kCu ", "@benparr ", "No ratings on #chibears yet (u r a pioneer!)", "Ask your friends to rate it here: http://tengrade.com/topics/uncategorized/chibears/ask-friends …", "Or try: #PhineasAndFerb", "@PaulPabst @dpshow BREAKING NEWS: Bears sign three free agents to mid-season roster. #ChiBears pic.twitter.com/hR9W7XxyrN", "Chicago Bears guard Matt Slauson, Loyola's Dr. Tonino discuss injury prevention - http://ow.ly/EapxL  #ChiBears | http://ow.ly/EapPO ", "@PralineMariePug @TheEllenShow @Starbucks looking scrumptious and ready for two things... ", "#ChiBears", "#chestnutpraline pic.twitter.com/17eTwjlsDl", "How I feel right now. #ChiBears #BearDown pic.twitter.com/Odo0YuzUhC", "Drinking a Blue Mosa while watching the #ChiBears game. (@ Buffalo Wild Wings - @bwwings in Round Lake Beach, IL) https://www.swarmapp.com/c/gazL1TbBstF ", "Chicago Bears mascot visits Ronald McDonald Children's Hospital | http://ow.ly/CJLlN  http://ow.ly/CJLlO  #ChiBears", "With friend which is fan of #ChiBears and I'm fan of #DallasCowboys (@ The Franchise Grill & Bar in Plano, TX) https://www.swarmapp.com/c/37CVGrmeRUL ", " twitter.html:22", "Solid game of football played today #Lions ya'll stepped up your game vs dem #ChiBears..  Sweet as sugar handin the Bears a whoopin!", "OB agrees w me. How is McClellin still on this team?!! #thescore #chibears", "Yes, @ChicagoBears!!! That's how you start the game!!! Let's go!! #CHIvsDET #keepthemomentumgoing #ChiBears", "Bears win today we make playoffs #WinOutTheSeason #ChiBears", "Let's go @ChicagoBears #ChiBears #CHIvDET", "@SeifertESPN @ESPNChiBears that's because they couldn't block anyone.  News flash, the O line is NOT fixed #chibears #bears #nfl", "Could #firetrestman have called #Packers this week for advice on crushing a Lovie defense #chibears #bears", "Remember when every team the #bears played for the past 2 years exploited Major Wright and Isaiah Frey like the liabilities they r #chibears", "Wow #chibears  just awful.", "ME MY SON AND WILLIAM SUTTON GLAD DUDE CAME OUT TO SUPPORT MY KIDS MANN MUCH LUV #BEARS #CHIBEARS… http://instagram.com/p/vjq-c5jnjD/ ", "photo of young Marc trestman #chibears pic.twitter.com/ZR1warKF7F", "It's about game time ladies and gentlemen! #MnVikes vs #ChiBears let's get'em boys!! #SKOLVIKES http://fb.me/1FzDD9kCu ", "@benparr ", "No ratings on #chibears yet (u r a pioneer!)", "Ask your friends to rate it here: http://tengrade.com/topics/uncategorized/chibears/ask-friends …", "Or try: #PhineasAndFerb", "@PaulPabst @dpshow BREAKING NEWS: Bears sign three free agents to mid-season roster. #ChiBears pic.twitter.com/hR9W7XxyrN", "Chicago Bears guard Matt Slauson, Loyola's Dr. Tonino discuss injury prevention - http://ow.ly/EapxL  #ChiBears | http://ow.ly/EapPO ", "@PralineMariePug @TheEllenShow @Starbucks looking scrumptious and ready for two things... ", "#ChiBears", "#chestnutpraline pic.twitter.com/17eTwjlsDl", "How I feel right now. #ChiBears #BearDown pic.twitter.com/Odo0YuzUhC", "Drinking a Blue Mosa while watching the #ChiBears game. (@ Buffalo Wild Wings - @bwwings in Round Lake Beach, IL) https://www.swarmapp.com/c/gazL1TbBstF ", "Chicago Bears mascot visits Ronald McDonald Children's Hospital | http://ow.ly/CJLlN  http://ow.ly/CJLlO  #ChiBears", "With friend which is fan of #ChiBears and I'm fan of #DallasCowboys (@ The Franchise Grill & Bar in Plano, TX) https://www.swarmapp.com/c/37CVGrmeRUL ", "Check out 2011 Santonio Holmes Prime Rookie Star 2-COLOR JERSEY PATCH SP /50 #ChicagoBears  http://www.ebay.com/itm/2011-Santonio-Holmes-Prime-Rookie-Star-2-COLOR-JERSEY-PATCH-SP-50-Chicago-Bears-/191354616741?roken=cUgayN&soutkn=LiV9DZ … #CHIBears #NFL via @eBay", "Checkout the highlights from the #CHIBears and #NYJets last night on Monday Night football http://buff.ly/ZHyU4O  #MNF #Bears #Jets", "So excited I got to see the Bears win last night!!!! #BearDown #Bearsvs49ers #ChiBears #BearDownChicagoBears pic.twitter.com/DY9c4GhpIX", "#sundaynightfootball with Dad. Lyles and tigers GO BEARS! Oh my! #chibears http://instagram.com/p/s8kZH5j4aw/ ", "Football season has officially started #football #fantasyfootball #fallsports #chibears http://instagram.com/p/sps5FztDOY/ ", "Bears Offense Needs to Show Growth in Year Two: http://g-b.co/1qlyoDR  #nfl #ChiBears", "@nike_bean23 RT #forsale Chicago Bears at San Francisco 49ers 09/14/2014  http://www.ebay.com/itm/-/191312690734?roken=cUgayN … via @eBay #49ers #ChiBears #ChicagoBears", "Projecting the Final @ChicagoBears Roster: http://g-b.co/1tT7HWW  #bears #chibears #nfl #football", "Support my step bro fales10 as he starts the #CHIBears vs #CLEBrowns tonight! #fales #davidfales http://instagram.com/p/sQtSxxDruc/ ", "Roster battles remain for @ChicagoBears in preseason finale: http://g-b.co/1lizP5e  #nfl #chibears", "Amy is not happy with the Bear's D in the first quarter #chibears pic.twitter.com/Nf1iRI33oz", "12 #NFL picks, featuring #NEPatriots #CHIBears #Seahawks #Chargers  and others, http://www.predictresults.co.uk/nfl-tips/ ", "This #Hawaii storm is making it hard to watch fales10 #chibears #bears #fales12 http://instagram.com/p/rdlCXUDrg6/ ", "Brandon hartson @brandonhartson gets 2 back to back punt snaps due to a penalty, perfect execution on both. #CHIbears #BearDown", "Not sure there is a long snapper in the pro football world right now who snaps the ball as fast as @brandonhartson #CHIbears", "@Jordanlynch06 took the time to take a pic with Jake today at camp today! Good Luck This Season! #ChiBears pic.twitter.com/TRDG5YssZS", "Martellus Bennett Slams Kyle Fuller Chicago Bears Practice Fight: http://youtu.be/jGmP43Zx4rc  via @YouTube #NFL #ChiBears #Chicago", "New Monsters of The Midway #Bears offense http://ow.ly/3nXVeL ", "#ChiBears", "RT @javi_mere 'Mark Green, former ND & #chibears player: 'you need to look at the whole picture to be a leader' #ALPFA'", "Bears had 4 shutouts, inc. 2 in the playoffs (back to back).  That's pretty good.  #85bears #chibears #nfl pic.twitter.com/HKbT6d2vgo", "Dave McClamrock #chibears @GENYOUthNow -Community Outreach: The Town Hall Model' @ExergameFitness #fuelupplaylearn pic.twitter.com/L4GUM5JOSH", "#MattForte, #JasonPierrePaul headline All-#AAC active alumni team. #NYGiants #ChiBears http://www.si.com/nfl/2014/06/27/all-american-athletic-conference-nfl-team?xid=nl_siextra …", "Found this ticket stub in a purse... Clearly the last time it was used was Sep 1998. #tbt #chibears… http://instagram.com/p/ptm3YszIf-/ ", "Chicago Bears pennant flag Flask.  Now if was just football season.  Go Bears!  #bears #chibears… http://instagram.com/p/pcCjyYEZX-/ ", "#ChicagoBearsMobile: Marshall agrees to three-year extension | http://bit.ly/1gHnXb2 ", "http://www.chicagobears.com/news/article-1/Marshall-agrees-to-three-year-extension/bc76bfef-3d8c-4134-8351-0589e4081202 … #chibears #monstersofthemidway", "Oh my god Roberto Garza follows me #dying #chibears #bestmondayever pic.twitter.com/tIKJiaJo8A", "#ChiBears fans are one of the NFL's best traveling teams, and this is why we have packages just for you #Bears fans! http://ow.ly/wWgJB ", "Chicago made Chicago raised till I die! #ChicagoFan #ChiBulls #ChiHawks #ChiBears pic.twitter.com/DZTThjhpZl", "#tbt a thrilled Otis Wilson gets ready to sign my headband.   #dabears #chibears #chicagobears… http://instagram.com/p/mWFhA-o0KS/ ", "Ranking the #Bears 1st Round Picks Since 2000; Plenty of picks, very little return. #ChiBears #BearsFam http://www.footballnation.com/content/chicago-bears-ranking-their-no-1-draft-picks-since-2000/29041/ …", "#chibears #bears RT @ESPNChicago: Julius Peppers agrees to deal with Green Bay Packers http://es.pn/Nh33RV ", "Former Bears linebacker Brian Urlacher will spend time at Bucs training camp. http://www.tampabay.com/blogs/bucs/former-bears-lb-brian-urlacher-to-spend-time-at-bucs-camp/2163584 … #ChiBears #Bucs #Buccaneers", "Nike #airmax90s in some special #colourway for the Chicago Bears. #CHIbears #chicagobears #nike http://instagram.com/p/jc3vY4tQCl/ ", "#ChiBears Cutler Contract & Coaching Conundrum http://wp.me/p3ABMx-3x ", "#Bears 3 New Year's Resolutions for 2014; All three tie together on the defense. #ChiBears #BearsFam http://www.footballnation.com/content/chicago-bears-three-new-years-resolutions-for-2014/28044/ …", "Re-Signing Jay Cutler a Good Move by the Chicago Bears  http://goo.gl/RgaHCr  via @lastwordgcp #bears #chibears", "The Off-Broadway Production of the 2013 Chicago Bears Season Comes To An End http://goo.gl/N5nGbt  via @LASTWORDgcp #chibears #bears #nfl", "Let's go Bears!!! #Chicago #Dabears #chibears #bears #chicagobears #nfl pic.twitter.com/NBg9d1HjTw", "“@lastwordonsport: 'NEXT MAN UP' IS NOT A PHILOSOPHY http://goo.gl/xVVGs6  via @LASTWORDgcp #chibears #bears #nfl” AGREED. HEAR IT EVERYDAY", "'NEXT MAN UP' IS NOT A PHILOSOPHY http://goo.gl/xVVGs6  via @LASTWORDgcp #chibears #bears #nfl", "Bring it home Sunday #chibears #dabears #chicago #nfcnorth #nfl #christmas #xmas #bears http://instagram.com/p/iWs-BRyZjX/ ", "#Vikings Trip the #Bears: 5 Things We Learned; We saw some of McCown's limitations. #BearsFam #ChiBears #ChicagoBears http://www.footballnation.com/content/vikings-trip-bears-shortof-win-23-20-five-things-we-learned/27137/ …", "Trading Coach Tom Thibodeau May Be Best Option for Bulls http://goo.gl/0RD3p0  via @LASTWORDgcp #chibears #bulls #nba", "Heads up, for that wicked storm that hit #ChiBears game will hit #WNY, then #NYC & #NJ later on tonight & into Monday a.m.", "Let's go #ChiBears! #Chicago #Bears #sports #football #BearsNation http://instagram.com/p/g0xTKiywip/ ", "ohkayyy killa i see yu #ChiBears #59 @khas_greene20  http://instagram.com/p/gUWFlPLkqG/ ", "#ChiBears are 92-88-6 overall against the #Packers BUT GB has won the last 6 in a row and 8 of 9. Breakin it down on the @fox6blitz tonight", "25 Memorable #Bears v #Packers games; MNF has been a great stage for the rivalry. #ChiBears #GoPackGo http://www.footballnation.com/content/the-greatest-nfl-rivalry-25-memorable-bears-vs-packers-games/26257/ …", "Hey #chibears! This tired girl enjoyed the game. :) pic.twitter.com/Hqr4O36lMj", "Can we mix #DallasCowboys off with #chibears def I see Super Bowl all day", "Giants Mid-Week Report: Short-Week Horror http://goo.gl/djbXEK  via @CMB1979 #nygiants #nyg #gmen #nfl #chibears", "Which team will have the magic touch in today's matchup? #NOSaints http://bit.ly/18safj8  or #ChiBears http://bit.ly/19JcptQ ", "awesome RT @EricLeeee Good morning #chibears ! I'm going to see ky1elong today! #beardown http://instagram.com/p/fIDGIwPcRl/ ", "“@TheOnion: Jay Cutler Proudly Watches Son Throw First Tantrum http://onion.com/18m5j0s ” lol! #chibears", "Watching my #ChiBears get trounced early... (@ Headquarters Beercade - @hq_chicago w/ 3 others) http://4sq.com/1eRZ3mr ", "#ChiBears http://instagram.com/p/e2S-1ysrO8/ ", "Football snack #osu #wildcats #ndfootball #chibears.  Chicken florentine pic.twitter.com/kTRDSFSh2I", "Despite losing Melton, the @ChicagoBears will likely limit the blitz, says @chadruter : http://g-b.co/18wszYE  #NFL #ChiBears", "#Vikings vs #Bears: 3 Bold Predictions; Can the Bears keep Cutler clean a second straight week? #ChiBears #BearsFam http://www.footballnation.com/content/minnesota-vikings-chicago-bears-three-bold-predictions/24951/ …", "'my first bears game' :)", "#dabears #footballseason #CHIbears #beardown #woof pic.twitter.com/3ttw5vCGoG", "#ChiBears http://instagram.com/p/eAdEvVQj7z/ ", "Football time #beardown #nfl #football #chibears it's a celebration citizens http://instagram.com/p/eADMOkAB0M/ ", "I can't wait for Chicago Bear's football! #ChiBears", "75-yd Peete to Richard Johnson TD bomb on final play of game lifts the #DETLions over #CHIBears in #Tecmo thriller http://twitpic.com/dbyz17 ", "Con Brandon Marshall #15 receptor estrella de los Chicago Bears, listo para temporada 2013 #ChiBears… http://instagram.com/p/d2aqIjxHJ1/ ", "http://www.nfl.com/news/story/0ap1000000234850/article/nfc-north-preview-packers-not-unanimous-pick?campaign=Twitter_atl … #ChiBears", "#Bears vs #Raiders: 5 Things We learned; Forte ready to party like it's 2011. #BearsFam #ChiBears #BearsNation http://www.footballnation.com/content/bears-vs-raiders-preseason-game-5-things-we-learned/24378/ …", "The top two spots in all the land - http://es.pn/1daVvM5  #stlcards #chibears", "IT'S GAME DAY CHICAGO!!!!! #chibears #nfl #nflpreseason #CHIvsOAK #cutler pic.twitter.com/27YH0Pox8N", "jewels_by_j #chicagobears  color inspired football bracelet #chibears http://instagram.com/p/dIhNIiNO0I/ ", "This is what you get at #soldierfield #United during a #ChiBears #footballgame pic.twitter.com/OWDxtJsicV", "In Preseason Debuts Marquess Wilson Impresses for #ChiBears, Tuel to Play Significant Time for #Bills Today… http://allcougdup.com/?p=4635 ", "The GM of the Future - Great article on Grantland on Phil Emery and future of the #CHIBears. Have a looksie. http://tmblr.co/ZrEQSuri5WTt ", "LOL im in tears #Bears #BearDown #Chicago #ChicagoBears #CHI #CHIBears #W #Win #DaBears #NFCNorth #NFL… http://instagram.com/p/csqtbKnCqk/ ", "As a Bears fan I am happy to see we got Pope! #Champ #ChiBears #NFL"];
/* VIEW CONTROLLER */

var static_markov_chain = getMarkovChainFromHumanPhrases();
//var static_markov_chain = new Object();

//SETTINGS//
var AI_SHOULD_LEARN = true;

function initPage()
{
	setupNewRound();
}

function setupNewRound()
{
	var human_phrase = getSinglePhrase();
	var algorithm_phrase = getAlgorithmPhrase(3, static_markov_chain);

	if(Math.random() > 0.5)
	{
		$("#phrase1").text(human_phrase);
		$("#btn1").attr("human", "true");

		$("#phrase2").text(algorithm_phrase);
		$("#btn2").attr("human", "false");
	}
	else
	{
		$("#phrase1").text(algorithm_phrase);
		$("#btn1").attr("human", "false");

		$("#phrase2").text(human_phrase);
		$("#btn2").attr("human", "true");
	}
}

function evalButtonPress(num)
{
	if($("#btn"+num).attr("human") == "true")
	{
		var score_count = parseInt($("#score").attr("count")) + 1;

		$("#score").attr("count", score_count);
		$("#score").text("Score: " + score_count);
		$("#previousguess").text("Correct!");
	}
	else
	{
		$("#previousguess").text("Wrong!");
		
		if(AI_SHOULD_LEARN) addPhraseToMarkovChain($("#phrase"+num).text(), static_markov_chain);
	}

	var guess_count = parseInt($("#guesscounter").attr("count")) + 1;

	$("#guesscounter").attr("count", guess_count);
	$("#guesscounter").text("Guesses: " + guess_count);

	setupNewRound();
}

function evalTie()
{
	var ai_phrase = "";

	if($("#btn1").attr("human") == "true")
	{
		ai_phrase = $("#phrase1").text();
	}
	else
	{
		ai_phrase = $("#phrase2").text();
	}

	if(AI_SHOULD_LEARN) addPhraseToMarkovChain(ai_phrase, static_markov_chain);

	var tie_count = parseInt($("#tiecounter").attr("count")) + 1;

	$("#tiecounter").attr("count", tie_count);
	$("#tiecounter").text("Ties: "+ tie_count);

	$("#previousguess").text("Tie!");

	setupNewRound();
}

function importChain()
{
	static_markov_chain = JSON.parse($("#chaintext").val());
}

function exportChain()
{
	console.log(JSON.stringify(static_markov_chain));
}

/* HUMAN PHRASE DATASET LIASON */

function getSinglePhrase()
{
	var index = Math.floor(Math.random() * human_phrase_dataset.length);

	return getSinglePhraseByIndex(index);
}

function getSinglePhraseByIndex(index)
{
	return human_phrase_dataset[index];
}

function getManyPhrases(num_to_get)
{
	var selected_phrases_reference = [];
	var phrases_to_be_returned = [];

	while(phrases_to_be_returned.length < num_to_get)
	{
		var index = Math.floor(Math.random() * human_phrase_dataset.length);
		var valid_phrase = false;

		while(!valid_phrase)
		{
			if(typeof selected_phrases_reference[index] == "undefined") //If this phrase hasn't been added yet
			{
				phrases_to_be_returned.push(getSinglePhraseByIndex(index));
				selected_phrases_reference[index] = true;
				valid_phrase = true;
			}

			else
			{
				index = index + 1 % (human_phrase_dataset.length-1);
			}
		}
	}

	return phrases_to_be_returned;
}

function getAllPhrasesFromDataset()
{
	return human_phrase_dataset;
}

/* MARKOV CHAIN GENERATOR */

function getMarkovChainFromHumanPhrases()
{
	var phrases = getAllPhrasesFromDataset();

	var markovChain = new Object();

	markovChain.startwords = [];
	markovChain.corewords = new Object();

	for(var c = 0; c < phrases.length; c++)
	{
		addPhraseToMarkovChain(phrases[c], markovChain);
	}

	return markovChain;
}

function addPhraseToMarkovChain(phrase, chain)
{
	var words_from_phrase = phrase.split(' ');

	if(chainIsNotValid(chain))
	{
		chain.startwords = new Object();
		chain.corewords = new Object();
	}

	var final_word = words_from_phrase[words_from_phrase.length-1];

	if(typeof chain.corewords[final_word] == "undefined")
	{
		chain.corewords[final_word] = new Object();
		chain.corewords[final_word].word = final_word;
		chain.corewords[final_word].next_words = [];
	}
	chain.corewords[final_word].terminal = true;

	chain.startwords = addWordToWeightArray(words_from_phrase[0], chain.startwords);

	for(var i = 0; i < words_from_phrase.length; i++)
	{
		var working_word = words_from_phrase[i];
		var next_word = words_from_phrase[i+1];

		if(chain.corewords.hasOwnProperty(working_word))
		{
			chain.corewords[working_word].next_words = addWordToWeightArray(next_word, chain.corewords[working_word].next_words);
		}
		else
		{
			var temp_word_obj = new Object();

			temp_word_obj.word = working_word;
			temp_word_obj.terminal = false;
			temp_word_obj.next_words = [];
			temp_word_obj.next_words = addWordToWeightArray(next_word, temp_word_obj.next_words);

			chain.corewords[working_word] = temp_word_obj;
		}
	}

	return chain;
}

function addWordToWeightArray(word, weight_array)
{
	if(typeof word == "undefined") return weight_array;

	for(var i = 0; i < weight_array.length; i++)
	{
		var working_weight = weight_array[i];

		if(working_weight.word == word)
		{
			working_weight.weight += 1;
			return weight_array;
		}
	}

	weight_array.push({"word": word, "weight": 1});
	return weight_array;
}

function chainIsNotValid(chain)
{
	return (typeof chain.corewords == "undefined" || typeof chain.startwords == "undefined");
}

/* PHRASE GENERATOR */

var weightedChoice = function(array) 
{
	var weight_sum = 0;

	for(var i = 0; i < array.length; i++)
	{
		weight_sum += array[i].weight;
	}

	var weighted_index = Math.floor(Math.random()*weight_sum);

	for(var i = 0; i < array.length; i++)
	{
		weighted_index -= array[i].weight;

		if(weighted_index <= 0) return array[i];
	}

	return array[array.length-1];
};

var getAlgorithmPhrase = function(min_length, working_chain)
{
	var word = weightedChoice(working_chain.startwords).word;
	var phrase = [word];

	while(typeof working_chain.corewords[word] != "undefined")
	{
		var next_words = working_chain.corewords[word].next_words;

		var next_word_object = weightedChoice(next_words);
		if(typeof next_word_object == "undefined") break;

		word = next_word_object.word;
		phrase.push(word);

		if(phrase.length > min_length && working_chain.corewords[word].terminal) break;
	}

	if(phrase.length < min_length)
	{
		return getAlgorithmPhrase(min_length, working_chain);
	}

	return phrase.join(' ');
}


//GET THINGS STARTED

initPage();